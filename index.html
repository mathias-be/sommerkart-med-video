<!DOCTYPE html>
<html lang="no">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Sommerkart</title>

<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-title" content="Sommerkart" />

<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
/>

<style>
:root {
  --header: 56px;
  --tabbar: 56px;
}

* { box-sizing: border-box; }

body {
  margin: 0;
  background: #000;
  color: #fff;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
}

/* HEADER */
header {
  height: var(--header);
  display: flex;
  align-items: center;
  justify-content: center;
  background: #111;
  border-bottom: 1px solid #222;
}
header h1 {
  margin: 0;
  font-size: 1.4rem;
  font-family: Georgia, serif;
}

/* APP */
#app {
  height: calc(100vh - var(--header) - var(--tabbar));
  position: relative;
}

/* VIEWS */
.view {
  position: absolute;
  inset: 0;
  display: none;
}
.view.active {
  display: block;
}

/* MAP */
#map {
  width: 100%;
  height: 100%;
  background: #e0e0e0;
}

/* MAP BUTTONS */
#map-controls {
  position: absolute;
  top: 12px;
  right: 12px;
  display: flex;
  flex-direction: column;
  gap: 8px;
  z-index: 1000;
}
#map-controls button {
  background: rgba(255,255,255,0.95);
  color: #000;
  border: none;
  padding: 6px 10px;
  border-radius: 999px;
  font-size: 13px;
}

/* TABBAR */
#tabbar {
  height: var(--tabbar);
  display: flex;
  justify-content: space-around;
  align-items: center;
  background: #111;
  border-top: 1px solid #222;
}
#tabbar button {
  background: none;
  border: none;
  color: #aaa;
  font-size: 13px;
  display: flex;
  flex-direction: column;
}
#tabbar button.active {
  color: #fff;
}

/* REELS */
#reels {
  overflow-y: auto;
  scroll-snap-type: y mandatory;
}
.reel {
  height: 100%;
  scroll-snap-align: start;
  position: relative;
}
.reel video {
  width: 100%;
  height: 100%;
  object-fit: contain;
  background: #000;
}
.reel-info {
  position: absolute;
  top: 12px;
  left: 12px;
  right: 12px;
  font-size: 14px;
  pointer-events: none;
}

/* ICONS */
.emoji-icon {
  width: 48px;
  height: 48px;
  font-size: 28px;
  background: rgba(255,255,255,0.95);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
}
</style>
</head>

<body>
<header>
  <h1>Sommerkart</h1>
</header>

<div id="app">

  <!-- MAP VIEW -->
  <div id="map-view" class="view active">
    <div id="map"></div>
    <div id="map-controls">
      <button id="btn-home">üó∫ Hele kartet</button>
      <button id="btn-softis">üç¶ Softis</button>
      <button id="btn-locate">üìç Finn meg</button>
    </div>
  </div>

  <!-- REELS VIEW -->
  <div id="reels-view" class="view">
    <div id="reels"></div>
  </div>

</div>

<!-- TABBAR -->
<div id="tabbar">
  <button id="tab-map" class="active">üó∫<span>Kart</span></button>
  <button id="tab-reels">üéû<span>Reels</span></button>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
/* DATA */
const spots = [
  { name:"Foten", lat:59.17035, lon:10.82661, video:"foten.mp4" },
  { name:"Glufsa", lat:59.17639, lon:10.88216, video:"glufsa.mp4" },
  { name:"M√¶rrapanna", lat:59.19746, lon:10.79604, video:"maerrapanna.mp4" },
  { name:"Dammene", lat:59.23239, lon:10.94751, video:"dammene.mp4" },
  { name:"Gamlebyen", lat:59.20096, lon:10.9487, video:"jangle-pa-vollane.mp4" },
  { name:"Sentrum", lat:59.21317, lon:10.93562, video:"varmen.mp4" },
  { name:"IDYLL", lat:59.20229, lon:10.94477, video:"idyll.mp4" },
  { name:"S√¶rping√¶r", lat:59.21235, lon:10.93556, video:"saerpingaer.mp4" },
  { name:"Softis", lat:59.20847, lon:10.94176, video:"softis.mp4" }
];

/* MAP */
const map = L.map("map").setView([59.19,10.86],11);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);

const icons = {
  Softis:"üç¶", IDYLL:"üé§", Sentrum:"ü•µ", S√¶rping√¶r:"‚öΩÔ∏è"
};

const markers = {};
spots.forEach(s=>{
  const icon = L.divIcon({
    className:"emoji-icon",
    html: icons[s.name] || "‚õ±Ô∏è",
    iconSize:[48,48], iconAnchor:[24,48]
  });
  const m = L.marker([s.lat,s.lon],{icon}).addTo(map);
  m.bindPopup(`<b>${s.name}</b><br><video controls width="100%" src="${s.video}"></video>`);
  markers[s.name]=m;
});

/* MAP BUTTONS */
btnHome.onclick=()=>map.setView([59.19,10.86],11);
btnSoftis.onclick=()=>{
  const s=spots.find(x=>x.name==="Softis");
  map.setView([s.lat,s.lon],17);
  markers.Softis.openPopup();
};
btnLocate.onclick=()=>{
  navigator.geolocation.getCurrentPosition(p=>{
    map.setView([p.coords.latitude,p.coords.longitude],15);
  });
};

/* REELS */
const reels=document.getElementById("reels");
spots.forEach(s=>{
  const r=document.createElement("div");
  r.className="reel";
  r.innerHTML=`
    <div class="reel-info"><b>${s.name}</b></div>
    <video controls playsinline preload="metadata" src="${s.video}"></video>
  `;
  reels.appendChild(r);
});

/* TABS */
tabMap.onclick=()=>{
  mapView.classList.add("active");
  reelsView.classList.remove("active");
  tabMap.classList.add("active");
  tabReels.classList.remove("active");
  setTimeout(()=>map.invalidateSize(),100);
};
tabReels.onclick=()=>{
  mapView.classList.remove("active");
  reelsView.classList.add("active");
  tabMap.classList.remove("active");
  tabReels.classList.add("active");
};

/* FIX BLACK MAP */
window.addEventListener("load",()=>setTimeout(()=>map.invalidateSize(),200));
</script>
</body>
</html>
